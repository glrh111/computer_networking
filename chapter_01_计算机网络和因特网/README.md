## 1.1 什么是因特网

本书一般讨论公共因特网
1. 能够描述因特网的具体构成，即构成因特网的基本硬件和软件组件
2. 我们能够根据为分布式应用提供服务的联网基础设施来描述因特网

### 1.1.1 具体构成描述

所有接入因特网的设备，称作主机 host，或者端系统 end system.

通信链路Communication Link 分组交换机 Packet Switch(路由器Router 链路层交换机Link-Layer Switch等)


因特网标准由IETF（因特网工程任务组 Internet Engineering Task Force）
研发，IETF的标准文档成为RFC（请求评论 Request For Comment）

### 1.1.2 服务描述

因特网应用程序，运行在端系统end system中，并不是在网络核心的分组交换机中。

### 1.1.3 因特网协议

一个协议定义了在两个或多个通信实体之间，交换的报文格式和次序，以及报文发送或/和接收一条报文或其他事件所采取的动作。

因特网广泛地使用了协议，不同的协议用于完成不同的通信任务。掌握计算机网络领域知识的过程，就是理解网络协议的构成，原理和工作方式的过程。

## 1.2 网络边缘

### 接入网 access network

将端系统连接到其边缘路由器(edge router)的物理链路. 边缘路由器是端系统到任何其他远程端系统的路径上的第一台机器。

#### 家庭接入 DSL 电缆 FTTH 拨号和卫星

DSL 数字用户线 Digital Subscriber Line 和电缆，是宽带住宅接入的两种最主要方式。
适合5~10英里以内的短距离接入。

![DSL](http://o9hjg7h8u.bkt.clouddn.com/Screenshot%20from%202017-11-17%2014-57-46.png)

在本地电话公司的一侧，DSLAM将数据和电话信号分隔开，并将数据送往因特网中。

电缆因特网接入 Cable Internet Access 利用现有电视线路。同时结合光纤使用。

光纤到户 Fiber To The Home . 从本地中心局拉出一根光纤，在家庭附近由光纤分配器为每户分配一根光纤。

两种光纤分配体系：
1. AON 主动光纤网络 Active Optical Network
2. PON 被动光纤网络 Passive Optical Network 

#### 企业（和家庭）接入：以太网和WiFi

以太网是目前为止当前公司、学校、家庭最为流行的（LAN局域网）接入技术。以太网用户使用双绞铜线与一台以太交换机相连。

WiFi有效范围大概几十米

#### 广域无线接入 3G和LTE

3G信号可以达到距离基站几万米的地方。

### 物理媒体 Physical Medium

分为两类：
+ 导引型媒体 guided media  电波沿着固体媒体前行，如光缆，双绞铜线，同轴电缆等。
+ 非导引型媒体 unguided media  电波在空气或外层空间中传播，无线局域网，数字卫星频道等

物理链路的实际成本与其他网络成本相比非常小。劳动力成本则高出几个数量级。所系许多建筑商都在一个建筑物中的每个房间安装双绞线，光缆，和同轴电缆。

#### 1 双绞铜线

最便宜，使用最普遍。普遍用作电话线。

#### 2 同轴电缆

普遍用于电缆电视系统中。

#### 3 光纤

细而柔软，能够引导光脉冲的媒体，每个脉冲代表一个bit。理论速率高，不受电磁干扰。适合用作长途导引型媒体。

光载波OC Optical Carrier 标准链路速率的范围，从51.8Mbps，到39.8Gbps。这些标准被成为OC-n，链路速率等于n * 51.8Mbps;

#### 4 陆地无线电信道

无线电信道承载电磁频谱中的信号。
+ 短距离 1米～2米：蓝牙等
+ 运行在局域，几十几百米：无线LAN
+ 广域，跨越数万米：3G等

#### 5 卫星无线电信道

一颗通信卫星连接两个或多个位于地球的微博发射方或者接收方，他们被成为地面站。

## 1.3 网络核心

互联因特网端系统的分组交换机和链路构成的网状网络。

### 1.3.1 网络分组交换

各种网络应用中，端系统彼此交换报文message。

为了从源端系统向目的端系统发送报文，源将长报文划分为较小的数据块，称之为分组。packet。
在源和目的端系统之间，每个分组都通过通信链路，和分组交换机packet switch传送。

有点疑问：距离和线路速度，最终决定数据传输实际延迟。

#### 1 存储转发传输

多数分组交换机在链路的输入端使用存储转发传输store-and-forward transmission. 即在接受完整packet的时候，才向输出链路转发传输。
 
N条速率为R的链路(N-1个路由器)，从源到目的地的延时为： d = N * L / R
 
#### 2 排队时延和丢包

每个分组交换机有多条链路与之相连，分组交换机具有输出缓存Output Buffer.

packet需要承受排队时延 queue delay。这些时延随着网络的拥塞程度变化。

如果packet到达的时候，发现Buffer满了，这时会出现丢包packet loss, 到达的packet或者已经排队的分组之一将被丢弃。

#### 3 转发表和路由选择协议

路由器如何选择转发线路？不同的计算机网络以不同的方式完成。

每台路由器都有一个转发表forwarding table，用于将目的ip地址映射成为输出链路。

### 1.3.2 电路交换

通过网络链路和交换机移动数据有两种方法：
+ 电路交换 circuit switching 端系统会话期间，预留了端系统通信沿路径所需要的资源（缓存，链路传输速率等），传统电话网络用此。
+ 分组交换 packet switching 资源不预留。后果是packet可能需要等待。

#### 1 电路交换网络中的复用

链路中的电路是通过下面两种技术实现
+ 频分复用Frequency-Division Multiplexing FDM。每个连接专用一个频段。电话网络中，每个频段具有4kHz的宽度，成为带宽bandwidth。
调频无线电台也是用FDM共享88～108MHz的频谱。
+ 时分复用Time-Division Multiplexing TDM。时间被划分为固定区间的帧，每帧被划分为固定数量的时隙。
创建连接时，网络在每帧中为该连接在每个帧中指定一个时隙。

#### 分组交换与电路交换的对比

显而易见。分组交换有利于共享链路。

### 1.3.3 网络中的网络

区域ISP与顶层ISP连接，这样每个end system就可以找到世界上其他任何end system了。

网络结构4：由接入ISP，区域ISP，第一层ISP，PoP，多宿multi-home，对等peer，IXP组成的生态系统。

网络结构5（描述了2012年的因特网）：在上述描述中增加内容提供商content provider network（如google）构建而成。
![网络结构5](http://o9hjg7h8u.bkt.clouddn.com/Screenshot%20from%202017-11-17%2018-10-46.png)

## 1.4 分组交换网中的时延、丢包和吞吐量

### 1.4.1 分组交换网中的时延概念

最重要的时延如下
+ 节点处理时延nodal processing delay 检查该packet首部，决定packet路由向何处，检查byte级别的差错；之后在路由器排队
+ 排队时延 queuing delay 取决于队列中packet数量
+ 传输时延 transmission delay 将所有packet推入输出线路的时间 = packet长度 / 链路传输速率
+ 传播时延 propagation delay 取决于链路的物理媒介，略等于光速。= 距离 / 传播速度

累加起来是节点总时延：total nodal delay

### 1.4.2 排队时延和丢包 packet loss

R 传输速率(bps)，L 每个分组的bit比特数量()，a 分组到达队列的平均速率(pkt/s)，定义流量强度 La/R (traffic intensity)

La/R>1的时候，队列趋向于无限增加；所以设计系统时，流量强度不能大于1.

La/R<=1 的时候，得分周期性流量，突发性流量，随机性流量（实际）讨论。

### 1.4.3 端到端时延

traceroute 源和目的地之间有N-1台机器，源向网络发送N个特殊的packet，每个packet地址指向最终的而目的地，
当第n台路由器收到标识为n的packet时，向源传送一个报文。当目的主机接受第N个packet时，也同样回送报文。
每次发送packet时，重复3次。

除了上述讨论的四种时延，端系统、应用程序和其他地方也会存在时延。

### 1.4.4 计算机网络中的吞吐量

时延，丢包之外，另外一个测定互联网性能的指标，是端到端吞吐量。

A～B传送一个文件，瞬时吞吐量instantaneous throughput 是以主机B接收该文件的速率bps计。
 
## 1.5 协议层次及其服务模型

互联网是一个极其复杂的系统。但我们依然有办法组织网络体系结构。

### 1.5.1 分层的体系架构

#### 协议分层

分层提供了一种结构化的方式来讨论系统组件。但有一个潜在的缺点：一层可能冗余较低层的功能。

各层的所有协议，称为协议栈protocol stack.
 
 可以参考这个：`https://zh.wikipedia.org/wiki/TCP/IP%E5%8D%8F%E8%AE%AE%E6%97%8F`

+ 应用层：应用层是网络应用程序和他们的应用层协议存留的地方。应用层的信息，称为报文message
+ 传输层：在end system 之间，传输应用层message。TCP面向连接 UDP无连接服务。运输层packet称为segment
+ 网络层：网络层packet称为datagram IP  网络层也包含决定路由的路由选择协议，网络中运行了很多种这个协议。
+ 链路层：链路层提供的服务，取决于应用于该链路的特定链路层协议。链路层packet成为帧frame
+ 物理层：链路相关。

#### OSI模型

Open System Interconnection Reference Model

+ 表示层：使通信的应用程序能够解释交换数据的含义，数据压缩，数据加密，数据描述
+ 会话层：数据交换定界，同步功能，建立检查点和恢复方案等方法。

因特网缺少了OSI参考模型的两个层次，如果一个APP需要这两层，留给应用程序开发者自己处理。

### 1.5.2 封装

![网络上的信息传输](http://o9hjg7h8u.bkt.clouddn.com/%E7%BD%91%E7%BB%9C%E4%B8%8A%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93.png)

封装 encapsulation 每层的每个packet都包含首部字段和有效载荷字段link-layer frame

## 1.6 面对攻击的网络

僵尸网络 botnet 受害（被侵入）主机构成的网络。

恶意软件的自我复制self replicating

+ 病毒virus 是一种需要某种形式的用户交互来感染用户设备的恶意软件。例如包含恶意代码的电子邮件附件，一旦执行，就会向该用户的收件人发送邮件。
+ 蠕虫worm 无需任何明显用户交互就能进入设备的恶意软件。

DDoS攻击 Denial-of-Service attack
+ 弱点攻击：像一台目标主机的app发送精细制作的报文。如果顺序适当，那么服务器可能停止运行。
+ 带宽洪范：向目标主机发送大量packet，packet数量之多，使目标的接入链路变得拥塞，使得合法的packet无法到达服务器。
+ 连接洪范：向目标主机建立大量的TCP连接，使其停止接受合法的连接。

packet sniffer 嗅探器

IP哄骗 IP Spoofing 将具有虚假源地址的分组注入因特网

为何互联网从一开始，就落入这样一种不安全的境地：因为因特网最初就是基于“一群互相信任的用户，连接到一个透明的网络上”
这样的模型进行设计的，在这样的模型中，安全性没有必要。

## 1.7 计算机网络和因特网的历史

### 1.7.1 分组交换packet switching 的发展 1961~1972

20世纪60年代早期计算机的重要性越来越大，需要将这些计算机连接起来，而且对网络的突发性流量处理有要求。
当时电话线路使用的是，电路交换。

1972年底，ARPAnet有15个节点，运行NCP网络控制协议，就是RFC001

### 1.7.2 专用网络和网络互联 1972~1980

TCP UDP IP 三个协议在1970年代末在概念上已经完成。

### 1.7.3 网络的激增 1980～1990

1983年 ARPAnet从NCP迁移到TCP/IP

Minitel在法国政府的支持下，在民众中广泛使用。

### 1.7.4 因特网爆炸 20世纪90年代

Web在1989～1991年期间被CERN发明出来，并研制了HTTP，HTML，Web服务器和浏览器。

后来Netscape出现，1996年微软亦开发浏览器，1998年微软在浏览器大战中获胜。
2000年末，4种备受欢迎的APP：
+ 电子邮件
+ Web Web浏览和因特网商务
+ 即时通信 Instant Messaging
+ 对等文件共享 peer-to-peer 由Napster领衔

前两个APP出自专业研究机构，后两个由年轻创业者发明。

2000~2001年，互联网泡沫破裂，许多公司倒闭。

### 1.7.5 最新发展














